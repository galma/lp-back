version: "3"
services:
  react-app:
    build:
      context: ../lp-web
      dockerfile: ../lp-web/Dockerfile
    ports:
      - 3001:3001
    depends_on:
      - nest-app
    environment:
      - REACT_APP_API_URL=http://localhost:3000/v1
      - PORT=3001
    command: sh -c "npm run start"

  nest-app:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - 3000:3000
    depends_on:
      - db
    environment:
      - DB_HOST=db
      - DB_USER_NAME=postgres
      - DB_PASSWORD=supersecret
      - DB_PORT=5432
      - DB_NAME=test
      - ENVIRONMENT=local
      - RANDOM_ORG_API_KEY=ef1992d8-3ac7-4e79-9df9-6708b330aabb
      - USER_INITIAL_BALANCE=100
      - ENCRYPTION_KEY=2342342345sdfq34rdf232134dfdfsc3
      - JWT_PRIVATE_KEY=LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcFFJQkFBS0NBUUVBd2VtVFIxVklVT1hJNjdYdEQrVnNHSGQ3cGxWaE5rSlBzajlUcEVVVkY4ZnVJZm8zCjVvajRXTEQwZ3VySis4aWl3MTFZOG95WlNmajA0SHlZRVZGeFozYVd5MGFKSHZPUUZJMzJkQTdVM1RHWVFjUi8KQ2lTc3lMMVZpQWs2SzRCOWV3L0Rsdkh3ckFBTThBa3p3UG9tamJUNTA1ZUoyWEVleEZnb0wzWkJHTU41Y2tBMwp6c1k1WFk3dXpVUlJ1d1ZHMWpyekE3Zm44cWgrdWxIZnNXUHBua0wrZ29MZFU4L21nenFpek9NWE8xZW1hZVU1CnR5WGR3Qk1FWTZlaEVmc2tZY2R6Z1pMQU9ZdzR4UkpWL0NwdFluK25GalBKeWR1R1VFNmVOUmtPbWsxaDZQYmQKQmZOUFBpdEtKd3JsTXRtRTZaajR1QkFvbjdSakxMUzdBcy9SWHdJREFRQUJBb0lCQVFDRHB5QytLcEdwa3drQgp0NGVXNWsyb290NkpoS2cyblhqY2JSQk5sRFdJNnMycnRlVmtHSlI4S3RBblhsNzZHak1mYnU0bjV2dGY5SzNWCkIrSjZ4NCsyRGhhOU5rdDhmeUxRUWI0VTk4amYwSDh1RDhtc3lrK2hEcUxXZEdWUkNiQ243NEQ4cDVDZVJuNkMKTGMwOGRObmVGZ1FUKzJ1MC9JOUdBUkJ2Z05zYmd0U1VxbjZLanV1RHNCbTlLRCtPSTNaZit3VWJqYmRvQUhVaQpmRDRGUmU3cHdUbkhuNEMycW00dS9ndFpHbHgwQmRLa1B0b3gxNjFQNThWWFZ5aUREdVZRRFFSMGFxZXN2WkY1CnVoNkxOS0c5R2xnSE93Ukd6RkRUU1hwRitTa2VVamwyUWRpWnNzMkxmNkdpbGV0SW9sMUZKR2lpL0xiQ2dsTU0KWms4MlZJSkJBb0dCQU92MUt4V0ZDenNVZW14ZE1jREcvMmREVWUwM0RLOWFGSGFwNldXMUg0d3kxUTdReldIRQo5M0J4WGxPNENxdUptd0xZMnllbURCSDJGVWN3cGJZVlJvTHFtWUQyQmhmZ0c0YTIxSVN4ZGZ6K2tUSEpmVTg3CldEdW1ldDlzOUJPMDRycGVZZGJxaXJUR1pGVjMyOVVhVHlkbnVIdG9NVzdXMmZLMmFRNk5hRFIvQW9HQkFOSmkKSlBwT2svU29ESUovNVFTTXBvZWxvcTR1dk14UlRpTkMwVllJN01kc1VJNWJxNHpkQ01BMlRUbHB2cnZyRXdBUApDQXIyaWExR2JTb3hLMVVISDJ5YVpQempLQndWWjNvdEpzQVpQME8wYlhjSXJZMWRwVFhmYUVYeDlVUWhEaEl6CnJoOEtGcUJ6SWhRSW5NUEhZbCtnb0E3Tmw2NzZjcFNaNCtJeE5ITWhBb0dBWnNUaGZ2M3paa2dGQ2kyTS9lbXUKVTh0K1kxTVdzMGtJb0taZ2dXdmgwYTVTSGFIVDBrRjNoQUhjazVvVkM2RmpZbG9SR2JPNGpob2dLbUdGeTBoNAo3WXhBVDJyWVBJM2ZiMDB5UXBrSVNxaVZsSm10ZWxUZW1SeHBaK2FNYUFqZ3QwdGtVYmJWc3VhMXpJUG51Mms2CkVHK2NhaU4zWkU4dm5nYlV1d0hiNFFFQ2dZRUFscFRnMnJmN2RwWUJ2alpFZWFraVdOelpQOHI4SDFIaWw2SnYKcXlEZ09Tenh5N01aYXMyYVFkbWNGSWYzbVJGOG5BSW1RNUtLb0pkVDgyc1dGTm53U0ErS1VPZFdBaVBmMkxjUQprVmFBemJrSzBMUkpaSEd1bW95NVdiY0JVaTVHb0FpVmpHbndJQS9JU0lhUmpoL2I3WTVPZ2NudDA3UTI1dDN2Ckdpc1YyNEVDZ1lFQXNKbG5yNzhEZW91ZjFqTHZ6SVU4UW96TzRpTnlmbWFlUVY4c0YybkpnZ1h3MVgvTjlxaysKbjlpT3RGL1dndEdCRjRMR2dJdmg1bndVYkN3Y2tFdkQxOXJpZXQ5cVdZOXhYZnlONnFCZUNad0FTcFRXVHlMbwpuV3FBNmFFdkxaUGpjblFwSE9JQVhhT3prNEtDWU9VOTlqUEN1YlRBcWliblE1V0pqOW5XOTdjPQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQ==
      - JWT_PUBLIC_KEY=LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF3ZW1UUjFWSVVPWEk2N1h0RCtWcwpHSGQ3cGxWaE5rSlBzajlUcEVVVkY4ZnVJZm8zNW9qNFdMRDBndXJKKzhpaXcxMVk4b3laU2ZqMDRIeVlFVkZ4ClozYVd5MGFKSHZPUUZJMzJkQTdVM1RHWVFjUi9DaVNzeUwxVmlBazZLNEI5ZXcvRGx2SHdyQUFNOEFrendQb20KamJUNTA1ZUoyWEVleEZnb0wzWkJHTU41Y2tBM3pzWTVYWTd1elVSUnV3VkcxanJ6QTdmbjhxaCt1bEhmc1dQcApua0wrZ29MZFU4L21nenFpek9NWE8xZW1hZVU1dHlYZHdCTUVZNmVoRWZza1ljZHpnWkxBT1l3NHhSSlYvQ3B0ClluK25GalBKeWR1R1VFNmVOUmtPbWsxaDZQYmRCZk5QUGl0S0p3cmxNdG1FNlpqNHVCQW9uN1JqTExTN0FzL1IKWHdJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0t

    command: sh -c "npm run migration:run && npm run start"

  db:
    image: postgres
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=supersecret
      - POSTGRES_DB=test
    ports:
      - 5432:5432
